/**/_jsload2&&_jsload2('clayer', 'x.extend(vb.prototype,{ql:{},Rj:[],Uu:"",Cq:"",KG:"",rl:s,Yg:s,Xg:s,Wg:[],JG:0,pz:ca(),lz:ca(),Qu:ca(),Ed:function(){this.RG()},za:function(a,b){Jd.prototype.za.call(this,a,b);this.ql={};this.Rj=[];this.P=a;this.RG()},Gt:fa(q),remove:function(){Jd.prototype.remove.call(this);this.UT()},RG:function(){var a=this,b=a.P;b&&(this.pz=function(b){a.jT(b)},this.lz=function(b){a.KS(b)},this.Qu=function(b){a.JS(b)},b.addEventListener("mousemove",this.pz),b.addEventListener("onhotspotover",this.lz),b.addEventListener("onhotspotout", this.Qu),b.addEventListener("onzoomstart",this.Qu))},UT:function(){var a=this.P;a&&(a.removeEventListener("mousemove",this.pz),a.removeEventListener("onhotspotover",this.lz),a.removeEventListener("onhotspotout",this.Qu))},jT:function(a){var b=this,c=b.P,e=c.ya();if(c.la()<this.kc||c.Vd())b.pB();else if(a=e.Aj().Lg(a.point),e=e.le(),a=new Q(Math.floor(a.x*Math.pow(2,c.la()-18)),Math.floor(a.y*Math.pow(2,c.la()-18))),e=new Q(Math.floor(a.x/e),Math.floor(a.y/e)),this.Cq=c=e.x+"_"+e.y+"_"+c.la(),this.ql[c]){if(this.Uu!= c){b.pB();b.QG(this.ql[c]);this.Uu=c;for(var e=-1,a=0,f=this.Rj.length;a<f;a++)if(c==this.Rj[a]){e=a;break}0<=e&&(this.Rj.splice(e,e),this.Rj.push(c))}}else if(this.KG!=c){this.KG=c;e=Rd[parseInt(Math.random()*Rd.length)];a=b.fb;c=e+"/data?grids="+c+"&q="+a.$t+"&tags="+a.EO+"&filter="+a.filter+"&sortby="+a.vO+"&ak="+a.cC+"&page_size="+a.HN+"&age="+a.YJ;b.Kf?c+="&geotable_id="+b.Kf:b.Zn&&(c+="&databox_id="+b.Zn);var g=(1E5*Math.random()).toFixed(0);!A._rd&&(A._rd={});A._rd["_cbk"+g]=function(a){b.CS(a); delete A._rd["_cbk"+g]};sa(c+("&callback=BMap._rd._cbk"+g))}},CS:function(a){var b=this.P,c=a.content;if(!(a.status!=this.JG||!c||1>c.length)){for(var a=[],e=c[0].data,b=b.ya().Aj(),f=0,g=e.length;f<g;f++){var i=e[f][2].replace(vb.eU,"").split(","),i=b.Dh(new L(i[0],i[1]));a.push({pt:i,userdata:{name:e[f][0]||"name",size:e[f][4]?e[f][4].split("|"):[10,13],uid:e[f][1]||"",Yb:e[f][3]||"sid1"}})}c=c[0].grid.join("_");this.ql[c]=a;this.Rj.push(c);30<this.Rj.length&&(c=this.Rj.shift(),delete this.ql[c], delete c);this.Uu!=this.Cq&&(this.pB(),this.ql[this.Cq]&&(this.QG(this.ql[this.Cq]),this.Uu=this.Cq))}},QG:function(a){for(var b=this.P,c=0,e=a.length;c<e;c++){var f=a[c].userdata.size,g=f[0]/2,f=f[1]/2,g=new ob(a[c].pt,{offsets:[f,g,f,g],userData:a[c].userdata});b.VB(g,this.fb.fE)}},pB:function(){this.P.Vw(this.fb.fE)},KS:function(a){if(a.spots&&!(1>a.spots.length||a.spots[0].tag!=this.fb.fE)){this.Wg=a.spots;var b=this,a=this.Wg[0].getUserData().size[0],c="",e=b.P,f="",g=b.fb.nZ;0<this.Wg.length&& (c=this.Wg[0].getUserData().name);if(this.Yg)this.Yg.va(this.Wg[0].ma()),this.Xg.Pc(c),this.Xg.Rd(new M(a,0)),this.Yg.show(),c?this.Xg.show():this.Xg.aa();else{var i=this.Wg[0].getUserData().size,f=this.Wg[0].getUserData().Yb,k=this.Kf||this.Zn;this.rl=new nd(J.ta+"blank.gif",new M(i[0],i[1]),{anchor:new M(i[0]/2+1,i[1]/2+1)});this.tS(k,f,function(){b.Yg&&b.Yg.Xb(b.rl)});this.Yg=new W(this.Wg[0].ma(),{icon:this.rl,enableMassClear:t});e.Ra(this.Yg);this.Xg=new rd(c,{offset:new M(a,0)});this.Xg.Td({backgroundColor:g.backgroundColor, borderColor:g.borderColor});this.Yg.Lj(this.Xg);c?this.Xg.show():this.Xg.aa();this.Yg.addEventListener("onclick",function(){if(!(b.Wg.length<1)&&b.Wg[0].getUserData().uid){var a=b.fb,c=a.GY;if(b.Kf)c=a.HY;a=c+b.Wg[0].getUserData().uid+"?scope=2&ak="+a.cC;b.Kf&&(a=a+("&geotable_id="+b.Kf));var e=(Math.random()*1E5).toFixed(0);!A._rd&&(A._rd={});A._rd["_cbk"+e]=function(a){b.sS(a);delete A._rd["_cbk"+e]};sa(a+("&callback=BMap._rd._cbk"+e))}})}}},sS:function(a){var b=a.content;this.Kf&&(b=a.contents[0]); if(a&&a.status==this.JG&&b){var a={poiId:b.uid||"",databoxId:b.databox_id||"",title:this.Kf?b.title:b.name,address:this.Kf?b.address:b.addr,phoneNumber:b.tel||"",postcode:b.zip||"",provinceCode:1*b.province_id||-1,province:b.province||"",cityCode:1*b.city_id||-1,city:b.city||"",districtCode:1*b.district_id||-1,district:b.district||"",point:this.Kf?new L(b.location[0],b.location[1]):new L(b.longitude,b.latitude),tags:b.tag&&b.tag.replace(vb.hU,"").split(vb.fU),typeId:1*b.cla||-1,extendedData:b.ext|| {}},c=new x.lang.Pu("onhotspotclick");c.customPoi=a;c.content=b;this.dispatchEvent(c)}},JS:function(){this.Yg&&this.Yg.aa();this.Xg&&this.Xg.aa()},tS:function(a,b,c){var e=this,f=Sd+"?method=getstyle&databox="+a+"&sid="+b,g=(1E5*Math.random()).toFixed(0);if(!e.rl||!(e.rl.databoxid==a&&e.rl.sid==b))!A._rd&&(A._rd={}),A._rd["_cbk"+g]=function(a){var b="";0==a.status&&(b="data:image/png;base64,"+a.content.sid1);0<b.length&&(e.rl.fO(b),c&&c(a));delete A._rd["_cbk"+g]},sa(f+("&callback=BMap._rd._cbk"+ g))}}); ');